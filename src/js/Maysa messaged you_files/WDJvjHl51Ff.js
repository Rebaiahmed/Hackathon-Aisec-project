if (self.CavalryLogger) { CavalryLogger.start_js(["\/QIH\/"]); }

__d("ChatPrivacyDialog",["fbt","Arbiter","AsyncRequest","Bootloader","CSS","DOM","DOMScroll","Event","JSLogger","MercuryParticipantTypes","PresencePrivacy","Vector"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c,d,e,f,g,h){__p&&__p();this.dialog=a;a=a.getRoot();this._onlineRadio=b("DOM").scry(a,".onlineRadio")[0];this._onlineSection=b("DOM").scry(a,".onlineSection")[0];this._blacklistRadio=b("DOM").find(a,".blacklistRadio");this._blacklistSection=b("DOM").find(a,".blacklistSection");this._blacklistTokenizers=b("DOM").find(a,".blacklistTokenizers");this._blacklistTokenizerContainer=b("DOM").find(this._blacklistTokenizers,".listContainer");this._blacklistTokenizer=c;this._blacklistExceptionTokenizerContainer=b("DOM").find(this._blacklistTokenizers,".exceptionsContainer");this._blacklistExceptionTokenizer=d;this._whitelistRadio=b("DOM").find(a,".whitelistRadio");this._whitelistSection=b("DOM").find(a,".whitelistSection");this._whitelistTokenizers=b("DOM").find(a,".whitelistTokenizers");this._whitelistTokenizerContainer=b("DOM").find(this._whitelistTokenizers,".listContainer");this._whitelistTokenizer=e;this._whitelistExceptionTokenizerContainer=b("DOM").find(this._whitelistTokenizers,".exceptionsContainer");this._whitelistExceptionTokenizer=f;this._offlineRadio=b("DOM").find(a,".offlineRadio");this._offlineSection=b("DOM").find(a,".offlineSection");this._sections=[this._blacklistSection,this._whitelistSection,this._offlineSection];this._emptyWhitelistWarning=b("DOM").find(a,".offlineToAllWarning");this._settings=g;this._onRequest=!1;this._friendLists=h;this.nonFriends={};this._onlineRadio&&b("Event").listen(this._onlineRadio,"click",this._selectOnlineRadio.bind(this));b("Event").listen(this._blacklistRadio,"click",this._selectBlacklistRadio.bind(this));b("Event").listen(this._whitelistRadio,"click",this._selectWhitelistRadio.bind(this));b("Event").listen(this._offlineRadio,"click",this._selectOfflineRadio.bind(this));this._blacklistTokenizerInitialized=!1;this._blacklistExceptionTokenizerInitialized=!1;this._whitelistTokenizerInitialized=!1;this._whitelistExceptionTokenizerInitialized=!1;b("Arbiter").subscribe("Tokenizer/init",this._tokenizerInitialized.bind(this));this._settings.disable_whitelist&&b("CSS").hide(this._whitelistSection)}var c=a.prototype;c._tokenizerInitialized=function(a,c){__p&&__p();if(c==this._blacklistTokenizer)this._blacklistTokenizerInitialized=!0,this._initializeBlacklist();else if(c==this._blacklistExceptionTokenizer)this._blacklistExceptionTokenizerInitialized=!0,this._initializeBlacklistExceptions();else if(c==this._whitelistTokenizer)this._whitelistTokenizerInitialized=!0,this._initializeWhitelist();else if(c==this._whitelistExceptionTokenizer)this._whitelistExceptionTokenizerInitialized=!0,this._initializeWhitelistExceptions();else return;if(!this._blacklistTokenizerInitialized||!this._whitelistTokenizerInitialized)return;if(!this._blacklistExceptionTokenizerInitialized||!this._whitelistExceptionTokenizerInitialized)return;this._currentRadio=null;a=this._settings.default_radio;if(!a)b("PresencePrivacy").getVisibility()==b("PresencePrivacy").ONLINE?b("PresencePrivacy").getOnlinePolicy()===b("PresencePrivacy").ONLINE_TO_BLACKLIST?this._selectBlacklistRadio():this._selectWhitelistRadio():this._selectOfflineRadio();else switch(a){case"BLACKLIST":this._selectBlacklistRadio();break;case"WHITELIST":this._selectWhitelistRadio();break;case"OFFLINE":this._selectOfflineRadio();break}this.dialog.subscribe("confirm",this._dialogHandler.bind(this));this._settings.blacklist_exceptions.length>0&&b("CSS").show(this._blacklistExceptionTokenizerContainer);this._settings.whitelist_exceptions.length>0&&b("CSS").show(this._whitelistExceptionTokenizerContainer);b("Arbiter").subscribe("Form/change",this._tokenizerChange.bind(this))};c._setCurrentRadioTo=function(a,c){this._currentRadio&&(this._currentRadio.checked=!1),a.checked=!0,this._currentRadio=a,this._sections.forEach(function(a){c==a?(b("CSS").addClass(a,"selected"),b("CSS").removeClass(a,"unselected")):(b("CSS").addClass(a,"unselected"),b("CSS").removeClass(a,"selected"))}),this._updateEmptyWhitelistMessage()};c._showBlacklistTokenizer=function(){if(this._settings.disable_blacklist)return;var a=b("DOM").find(this._blacklistTokenizers,".tokenizerArea");b("CSS").show(a);b("Event").listen(a,"click",this._selectBlacklistRadio.bind(this))};c._bootstrapTokenizer=function(a,c){__p&&__p();for(var e=0;e<c.length;++e){var f=c[e];if(f in this._friendLists){var g=a.createToken({uid:f,text:this._friendLists[f].name});a.addToken(g)}else d(["ShortProfiles"],function(c){c.get(f.toString(),function(c,d){if(c.type===b("MercuryParticipantTypes").FRIEND){c=a.createToken({uid:d,text:c.name});a.addToken(c)}else this.nonFriends[d]=!0}.bind(this))}.bind(this))}a.subscribe(["addToken","removeToken"],this._updateEmptyWhitelistMessage.bind(this))};c._initializeBlacklist=function(){var a=this._settings.blacklist;this._bootstrapTokenizer(this._blacklistTokenizer,a);var c=b("DOM").find(this._blacklistTokenizers,".summaryArea");this._showBlacklistTokenizer();this._addClearButton(this._blacklistTokenizers,a,this._blacklistTokenizerContainer,this._blacklistTokenizer,"blacklist");b("Event").listen(c,"click",function(){b("CSS").hide(c),this._showBlacklistTokenizer(),this._selectBlacklistRadio()}.bind(this))};c._initializeBlacklistExceptions=function(){var a=this._settings.blacklist_exceptions;this._bootstrapTokenizer(this._blacklistExceptionTokenizer,a);a.length&&this._addClearButton(this._blacklistTokenizers,a,this._blacklistExceptionTokenizerContainer,this._blacklistExceptionTokenizer,"blacklist")};c._addClearButton=function(a,c,d,e,f){if(c.length>=10){f=b("DOM").find(d,".clearButtonPlaceholder");c=b("DOM").create("a",{href:"#"},g._("Clear"));b("DOM").setContent(f,c);b("Event").listen(c,"click",function(){e.removeAllTokens(),b("Vector").getElementPosition(a,"viewport").y<0&&b("DOMScroll").scrollTo(a,750,!0)}.bind(this))}};c._tokenizerChange=function(a,b){__p&&__p();if("node"in b){a=b.node;var c,d;switch(a){case this._blacklistTokenizer.getElement():c=this._blacklistTokenizer;d=this._blacklistExceptionTokenizer;break;case this._blacklistExceptionTokenizer.getElement():c=this._blacklistExceptionTokenizer;d=this._blacklistTokenizer;break;case this._whitelistTokenizer.getElement():c=this._whitelistTokenizer;d=this._whitelistExceptionTokenizer;break;case this._whitelistExceptionTokenizer.getElement():c=this._whitelistExceptionTokenizer;d=this._whitelistTokenizer;break}if(c&&d){var e={};c.getTokenValues().forEach(function(a){e[a]=!0});d.getTokens().forEach(function(a){a.getValue()in e&&d.removeToken(a)})}}};c._selectOfflineRadio=function(){this._setCurrentRadioTo(this._offlineRadio,this._offlineSection)};c._selectOnlineRadio=function(){this._setCurrentRadioTo(this._onlineRadio,this._onlineSection)};c._selectBlacklistRadio=function(){this._setCurrentRadioTo(this._blacklistRadio,this._blacklistSection)};c._initializeWhitelist=function(){var a=this._settings.whitelist;this._bootstrapTokenizer(this._whitelistTokenizer,a);var c=b("DOM").find(this._whitelistTokenizers,".tokenizerArea");b("CSS").show(c);this._addClearButton(this._whitelistTokenizers,a,this._whitelistTokenizerContainer,this._whitelistTokenizer,"whitelist");b("Event").listen(c,"click",this._selectWhitelistRadio.bind(this))};c._initializeWhitelistExceptions=function(){var a=this._settings.whitelist_exceptions;this._bootstrapTokenizer(this._whitelistExceptionTokenizer,a);a.length&&this._addClearButton(this._whitelistTokenizers,a,this._whitelistExceptionTokenizerContainer,this._whitelistExceptionTokenizer,"whitelist")};c._selectWhitelistRadio=function(){this._setCurrentRadioTo(this._whitelistRadio,this._whitelistSection)};c._hasEmptyWhitelist=function(){return this._currentRadio==this._whitelistRadio&&this._whitelistTokenizer.getTokens().length===0};c._updateEmptyWhitelistMessage=function(){this._hasEmptyWhitelist()||b("CSS").hide(this._emptyWhitelistWarning)};c._flattenTokens=function(a,b){var c={};a.forEach(function(a){if(a in this._friendLists)for(var b in this._friendLists[a].members)c[b]=!0;else c[a]=!0}.bind(this));b.forEach(function(a){delete c[a]}.bind(this));return c};c._processVisibilityForTokenizersWithExceptions=function(){this._settings.migrate_lists&&(this._currentRadio!=this._blacklistRadio&&(this._blacklistTokenizer.removeAllTokens(),this._blacklistExceptionTokenizer.removeAllTokens()),this._currentRadio!=this._whitelistRadio&&(this._whitelistTokenizer.removeAllTokens(),this._whitelistExceptionTokenizer.removeAllTokens()));var a={blacklist_ids:this._blacklistTokenizer.getTokenValues(),blacklist_ex_ids:this._blacklistExceptionTokenizer.getTokenValues(),whitelist_ids:this._whitelistTokenizer.getTokenValues(),whitelist_ex_ids:this._whitelistExceptionTokenizer.getTokenValues()},c={};this._getChangedSettingsMap(this._settings.blacklist,this._settings.blacklist_exceptions,this._blacklistTokenizer,this._blacklistExceptionTokenizer,b("PresencePrivacy").BLACKLISTED,c);this._getChangedSettingsMap(this._settings.whitelist,this._settings.whitelist_exceptions,this._whitelistTokenizer,this._whitelistExceptionTokenizer,b("PresencePrivacy").WHITELISTED,c);b("PresencePrivacy").setFriendVisibilityMap(c,new(b("AsyncRequest"))().setURI(this.LIST_SETTINGS_URI).setData(a))};c._getChangedSettingsMap=function(a,c,d,e,f,g){a=this._flattenTokens(a,c);c=this._flattenTokens(d.getTokenValues(),e.getTokenValues());for(d in c)d in a||(g[d]=f);for(d in a)d in c||(g[d]=b("PresencePrivacy").UNLISTED);return g};c._dialogHandler=function(a){__p&&__p();if(this._hasEmptyWhitelist()){this._getLogger().log("privacy_dialog_prevent_empty_whitelist");b("CSS").show(this._emptyWhitelistWarning);return!1}this._currentRadio==this._onlineRadio&&(this._selectBlacklistRadio(),this._blacklistTokenizer.removeAllTokens(),this._blacklistExceptionTokenizer.removeAllTokens());this._processVisibilityForTokenizersWithExceptions();if(this._currentRadio==this._offlineRadio)this._logEvent("dialog_submit_offline"),b("PresencePrivacy").getVisibility()!=b("PresencePrivacy").OFFLINE&&(d(["ChatVisibility"],function(a){a.goOffline()}),this._getLogger().log("privacy_dialog_go_offline")),b("PresencePrivacy").getOnlinePolicy()==b("PresencePrivacy").ONLINE_TO_WHITELIST&&this._whitelistTokenizer.getTokens().length===0&&b("PresencePrivacy").setOnlinePolicy(b("PresencePrivacy").ONLINE_TO_BLACKLIST);else{a=this._currentRadio==this._blacklistRadio?b("PresencePrivacy").ONLINE_TO_BLACKLIST:b("PresencePrivacy").ONLINE_TO_WHITELIST;var c=a==b("PresencePrivacy").ONLINE_TO_BLACKLIST?"dialog_submit_online_to_blacklist":"dialog_submit_online_to_whitelist";this._logEvent(c);b("PresencePrivacy").getVisibility()!=b("PresencePrivacy").ONLINE&&(d(["ChatVisibility"],function(a){a.goOnline()}),this._getLogger().log("privacy_dialog_go_online"));b("PresencePrivacy").getOnlinePolicy()!=a&&(b("PresencePrivacy").setOnlinePolicy(a),this._getLogger().log("privacy_dialog_set_policy",{policy:a}))}this.dialog.hide()};c._getLogger=function(){return b("JSLogger").create("blackbird")};c._logEvent=function(a){b("Bootloader").loadModules(["FunnelLogger"],function(c){c.appendActionWithTag("WWW_PRESENCE_FUNNEL",a,b("PresencePrivacy").getOnlinePolicyStr()),c.endFunnel("WWW_PRESENCE_FUNNEL")},"ChatPrivacyDialog")};return a}();Object.assign(a.prototype,{LIST_SETTINGS_URI:"/ajax/chat/privacy/list_based_settings.php"});e.exports=a}),null);
__d("GroupMallPopoverLauncher",["AsyncDialog","AsyncRequest"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(){}var c=a.prototype;c.construct=function(){};a.launchPopover=function(a){b("AsyncDialog").send(new(b("AsyncRequest"))(a))};return a}();e.exports=a}),null);